<!DOCTYPE html>
<html>
<head>
  <title>user-after.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="doc-style.css" />
  <script src="doc-filelist.js"></script>
  <script>
    var relativeDir = "", thisFile = "Users/xianchen/Warble//user-after.js", defaultSidebar = true;
  </script>
  <script src="doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#user-after.js">user-after.js</a>
      </div>
      <div class="heading h3">
        <a href="#records-the-user-logged-in">Records the user logged in</a>
      </div>
      <div class="heading h3">
        <a href="#records-all-users-that-are-logged-in-in-a--database-">Records all users that are logged in in a "database"</a>
      </div>
      <div class="heading h2">
        <a href="#flash">Flash</a>
      </div>
      <div class="heading h3">
        <a href="#if-value-is-not-undefined-we-are-setting-a-flash">If value is not undefined we are setting a flash</a>
      </div>
      <div class="heading h3">
        <a href="#value--i.e.--setting-a-cookie-.">value (i.e., setting a cookie).</a>
      </div>
      <div class="heading h3">
        <a href="#we-return-the-value-to-be-consistent-with-the">We return the value to be consistent with the</a>
      </div>
      <div class="heading h3">
        <a href="#alternative-call---to-retrieve-the-value.">alternative call - to retrieve the value.</a>
      </div>
      <div class="heading h3">
        <a href="#grab-the-value-from-the-cookies-sent-along-with">Grab the value from the cookies sent along with</a>
      </div>
      <div class="heading h3">
        <a href="#the-request.">the request.</a>
      </div>
      <div class="heading h3">
        <a href="#clear-the-cookie-in-the-response.">Clear the cookie in the response.</a>
      </div>
      <div class="heading h3">
        <a href="#return-the-value.">Return the value.</a>
      </div>
      <div class="heading h1">
        <a href="#user-server-side-routes">User Server-Side Routes</a>
      </div>
      <div class="heading h2">
        <a href="#login">login</a>
      </div>
      <div class="heading h3">
        <a href="#grab-any-messages-being-sent-to-use-from-redirect.">Grab any messages being sent to use from redirect.</a>
      </div>
      <div class="heading h3">
        <a href="#tdr--redirect-if-logged-in-">TDR: redirect if logged in:</a>
      </div>
      <div class="heading h3">
        <a href="#tdr--if-the-user-is-already-logged-in---we-redirect-to-the">TDR: If the user is already logged in - we redirect to the</a>
      </div>
      <div class="heading h3">
        <a href="#main-application-view.-we-must-check-both-that-the-userid">main application view. We must check both that the userid</a>
      </div>
      <div class="heading h3">
        <a href="#and-the-online-userid--are-undefined.-the-reason-is-that">and the online[userid] are undefined. The reason is that</a>
      </div>
      <div class="heading h3">
        <a href="#the-cookie-may-still-be-stored-on-the-client-even-if-the">the cookie may still be stored on the client even if the</a>
      </div>
      <div class="heading h3">
        <a href="#server-has-been-restarted.">server has been restarted.</a>
      </div>
      <div class="heading h3">
        <a href="#render-the-login-view-if-this-is-a-new-login.">Render the login view if this is a new login.</a>
      </div>
      <div class="heading h2">
        <a href="#auth">auth</a>
      </div>
      <div class="heading h3">
        <a href="#performs-basic-user-authentication.">Performs basic user authentication.</a>
      </div>
      <div class="heading h3">
        <a href="#tdr--redirect-if-logged-in-">TDR: redirect if logged in:</a>
      </div>
      <div class="heading h3">
        <a href="#tdr--do-the-check-as-described-in-the-exports.login-function.">TDR: do the check as described in the exports.login function.</a>
      </div>
      <div class="heading h3">
        <a href="#pull-the-values-from-the-form.">Pull the values from the form.</a>
      </div>
      <div class="heading h3">
        <a href="#perform-the-user-lookup.">Perform the user lookup.</a>
      </div>
      <div class="heading h3">
        <a href="#if-there-is-an-error-we--flash--a-message-to-the">If there is an error we "flash" a message to the</a>
      </div>
      <div class="heading h3">
        <a href="#redirected-route--user-login.">redirected route /user/login.</a>
      </div>
      <div class="heading h3">
        <a href="#tdr--use-cookie-to-record-stateful-connection.-here">TDR: use cookie to record stateful connection. Here</a>
      </div>
      <div class="heading h3">
        <a href="#we-record-the-generated-userid-as-a-cookie-to-be">we record the generated userid as a cookie to be</a>
      </div>
      <div class="heading h3">
        <a href="#passed-back-and-forth-between-client-and-server.">passed back and forth between client and server.</a>
      </div>
      <div class="heading h3">
        <a href="#store-the-user-in-our-in-memory-database.">Store the user in our in memory database.</a>
      </div>
      <div class="heading h3">
        <a href="#redirect-to-main.">Redirect to main.</a>
      </div>
      <div class="heading h2">
        <a href="#logout">logout</a>
      </div>
      <div class="heading h3">
        <a href="#deletes-user-info--amp--cookies---then-redirects-to-login.">Deletes user info &amp; cookies - then redirects to login.</a>
      </div>
      <div class="heading h3">
        <a href="#tdr--handle-cookies">TDR: handle cookies</a>
      </div>
      <div class="heading h2">
        <a href="#main">main</a>
      </div>
      <div class="heading h3">
        <a href="#the-main-user-view.">The main user view.</a>
      </div>
      <div class="heading h3">
        <a href="#tdr--added-cookie-support">TDR: added cookie support</a>
      </div>
      <div class="heading h2">
        <a href="#shows-the-other-users-online-at-a-point-in-time">shows the other users online at a point in time</a>
      </div>
      <div class="heading h2">
        <a href="#lets-users-discover-other-users-or-warbles">lets users discover other users or Warbles</a>
      </div>
      <div class="heading h2">
        <a href="#shows-warbles-at-a-user">shows Warbles at a user</a>
      </div>
      <div class="heading h2">
        <a href="#renders-about-page">renders about page</a>
      </div>
      <div class="heading h2">
        <a href="#allows-for-uploads">allows for uploads</a>
      </div>
      <div class="heading h2">
        <a href="#allows-for-users-and-warbles-to-be-displayed-on-profile-page">allows for users and warbles to be displayed on profile page</a>
      </div>
      <div class="heading h2">
        <a href="#gets-the-users-following-the-logged-in-warbler">gets the users following the logged in Warbler</a>
      </div>
      <div class="heading h2">
        <a href="#gets-the-users-a-warbler-is-following">gets the users a Warbler is following</a>
      </div>
      <div class="heading h2">
        <a href="#creates-user-list">creates user list</a>
      </div>
      <div class="heading h3">
        <a href="#processes-form-get-requests-">Processes form get requests:</a>
      </div>
      <div class="heading h2">
        <a href="#checks-for-user">checks for user</a>
      </div>
      <div class="heading h3">
        <a href="#displays-user">Displays user</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
<div class="pilwrap" id="user-after.js">
  <h1>
    <a href="#user-after.js" class="pilcrow">&#182;</a>
    user-after.js
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../lib/user&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="records-the-user-logged-in">
  <h3>
    <a href="#records-the-user-logged-in" class="pilcrow">&#182;</a>
    Records the user logged in
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">userids</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="records-all-users-that-are-logged-in-in-a--database-">
  <h3>
    <a href="#records-all-users-that-are-logged-in-in-a--database-" class="pilcrow">&#182;</a>
    Records all users that are logged in in a "database"
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">online</span> <span class="o">=</span> <span class="p">{};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="flash">
  <h2>
    <a href="#flash" class="pilcrow">&#182;</a>
    Flash
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="kd">function</span> <span class="nx">flash</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="if-value-is-not-undefined-we-are-setting-a-flash">
  <h3>
    <a href="#if-value-is-not-undefined-we-are-setting-a-flash" class="pilcrow">&#182;</a>
    If <code>value</code> is not undefined we are <em>setting</em> a flash
  </h3>
</div>



<div class="pilwrap" id="value--i.e.--setting-a-cookie-.">
  <h3>
    <a href="#value--i.e.--setting-a-cookie-." class="pilcrow">&#182;</a>
    value (i.e., setting a cookie).
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="we-return-the-value-to-be-consistent-with-the">
  <h3>
    <a href="#we-return-the-value-to-be-consistent-with-the" class="pilcrow">&#182;</a>
    We return the <code>value</code> to be consistent with the
  </h3>
</div>



<div class="pilwrap" id="alternative-call---to-retrieve-the-value.">
  <h3>
    <a href="#alternative-call---to-retrieve-the-value." class="pilcrow">&#182;</a>
    alternative call - to retrieve the value.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="grab-the-value-from-the-cookies-sent-along-with">
  <h3>
    <a href="#grab-the-value-from-the-cookies-sent-along-with" class="pilcrow">&#182;</a>
    Grab the <code>value</code> from the cookies sent along with
  </h3>
</div>



<div class="pilwrap" id="the-request.">
  <h3>
    <a href="#the-request." class="pilcrow">&#182;</a>
    the request.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">value</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="clear-the-cookie-in-the-response.">
  <h3>
    <a href="#clear-the-cookie-in-the-response." class="pilcrow">&#182;</a>
    Clear the cookie in the response.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">res</span><span class="p">.</span><span class="nx">clearCookie</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="return-the-value.">
  <h3>
    <a href="#return-the-value." class="pilcrow">&#182;</a>
    Return the <code>value</code>.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="user-server-side-routes">
  <h1>
    <a href="#user-server-side-routes" class="pilcrow">&#182;</a>
    User Server-Side Routes
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="login">
  <h2>
    <a href="#login" class="pilcrow">&#182;</a>
    login
  </h2>
</div>


<p>Provides a user login view.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">login</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="grab-any-messages-being-sent-to-use-from-redirect.">
  <h3>
    <a href="#grab-any-messages-being-sent-to-use-from-redirect." class="pilcrow">&#182;</a>
    Grab any messages being sent to use from redirect.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">authmessage</span> <span class="o">=</span> <span class="nx">flash</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="s1">&#39;auth&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="tdr--redirect-if-logged-in-">
  <h3>
    <a href="#tdr--redirect-if-logged-in-" class="pilcrow">&#182;</a>
    TDR: redirect if logged in:
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">userid</span>  <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">userid</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="tdr--if-the-user-is-already-logged-in---we-redirect-to-the">
  <h3>
    <a href="#tdr--if-the-user-is-already-logged-in---we-redirect-to-the" class="pilcrow">&#182;</a>
    TDR: If the user is already logged in - we redirect to the
  </h3>
</div>



<div class="pilwrap" id="main-application-view.-we-must-check-both-that-the-userid">
  <h3>
    <a href="#main-application-view.-we-must-check-both-that-the-userid" class="pilcrow">&#182;</a>
    main application view. We must check both that the <code>userid</code>
  </h3>
</div>



<div class="pilwrap" id="and-the-online-userid--are-undefined.-the-reason-is-that">
  <h3>
    <a href="#and-the-online-userid--are-undefined.-the-reason-is-that" class="pilcrow">&#182;</a>
    and the <code>online[userid]</code> are undefined. The reason is that
  </h3>
</div>



<div class="pilwrap" id="the-cookie-may-still-be-stored-on-the-client-even-if-the">
  <h3>
    <a href="#the-cookie-may-still-be-stored-on-the-client-even-if-the" class="pilcrow">&#182;</a>
    the cookie may still be stored on the client even if the
  </h3>
</div>



<div class="pilwrap" id="server-has-been-restarted.">
  <h3>
    <a href="#server-has-been-restarted." class="pilcrow">&#182;</a>
    server has been restarted.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="p">(</span><span class="nx">userid</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/user/main&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="render-the-login-view-if-this-is-a-new-login.">
  <h3>
    <a href="#render-the-login-view-if-this-is-a-new-login." class="pilcrow">&#182;</a>
    Render the login view if this is a new login.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span>   <span class="o">:</span> <span class="s1">&#39;User Login&#39;</span><span class="p">,</span>
                          <span class="nx">message</span> <span class="o">:</span> <span class="nx">authmessage</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="auth">
  <h2>
    <a href="#auth" class="pilcrow">&#182;</a>
    auth
  </h2>
</div>



<div class="pilwrap" id="performs-basic-user-authentication.">
  <h3>
    <a href="#performs-basic-user-authentication." class="pilcrow">&#182;</a>
    Performs <strong>basic</strong> user authentication.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">auth</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="tdr--redirect-if-logged-in-">
  <h3>
    <a href="#tdr--redirect-if-logged-in-" class="pilcrow">&#182;</a>
    TDR: redirect if logged in:
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">userid</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="tdr--do-the-check-as-described-in-the-exports.login-function.">
  <h3>
    <a href="#tdr--do-the-check-as-described-in-the-exports.login-function." class="pilcrow">&#182;</a>
    TDR: do the check as described in the <code>exports.login</code> function.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="p">(</span><span class="nx">userid</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/user/main&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="pull-the-values-from-the-form.">
  <h3>
    <a href="#pull-the-values-from-the-form." class="pilcrow">&#182;</a>
    Pull the values from the form.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="perform-the-user-lookup.">
  <h3>
    <a href="#perform-the-user-lookup." class="pilcrow">&#182;</a>
    Perform the user lookup.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">user</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="if-there-is-an-error-we--flash--a-message-to-the">
  <h3>
    <a href="#if-there-is-an-error-we--flash--a-message-to-the" class="pilcrow">&#182;</a>
    If there is an error we "flash" a message to the
  </h3>
</div>



<div class="pilwrap" id="redirected-route--user-login.">
  <h3>
    <a href="#redirected-route--user-login." class="pilcrow">&#182;</a>
    redirected route <code>/user/login</code>.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">flash</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/user/login&#39;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="tdr--use-cookie-to-record-stateful-connection.-here">
  <h3>
    <a href="#tdr--use-cookie-to-record-stateful-connection.-here" class="pilcrow">&#182;</a>
    TDR: use cookie to record stateful connection. Here
  </h3>
</div>



<div class="pilwrap" id="we-record-the-generated-userid-as-a-cookie-to-be">
  <h3>
    <a href="#we-record-the-generated-userid-as-a-cookie-to-be" class="pilcrow">&#182;</a>
    we record the generated userid as a cookie to be
  </h3>
</div>



<div class="pilwrap" id="passed-back-and-forth-between-client-and-server.">
  <h3>
    <a href="#passed-back-and-forth-between-client-and-server." class="pilcrow">&#182;</a>
    passed back and forth between client and server.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">userid</span> <span class="o">=</span> <span class="o">++</span><span class="nx">userids</span><span class="p">;</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;userid&#39;</span><span class="p">,</span>
                   <span class="nx">userid</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                   <span class="p">{</span> <span class="nx">maxAge</span> <span class="o">:</span> <span class="mi">900000</span> <span class="p">});</span> <span class="c1">// 15 minutes</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="store-the-user-in-our-in-memory-database.">
  <h3>
    <a href="#store-the-user-in-our-in-memory-database." class="pilcrow">&#182;</a>
    Store the user in our in memory database.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">]</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="redirect-to-main.">
  <h3>
    <a href="#redirect-to-main." class="pilcrow">&#182;</a>
    Redirect to main.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/user/main&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="logout">
  <h2>
    <a href="#logout" class="pilcrow">&#182;</a>
    logout
  </h2>
</div>



<div class="pilwrap" id="deletes-user-info--amp--cookies---then-redirects-to-login.">
  <h3>
    <a href="#deletes-user-info--amp--cookies---then-redirects-to-login." class="pilcrow">&#182;</a>
    Deletes user info &amp; cookies - then redirects to login.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">logout</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="tdr--handle-cookies">
  <h3>
    <a href="#tdr--handle-cookies" class="pilcrow">&#182;</a>
    TDR: handle cookies
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">userid</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">clearCookie</span><span class="p">(</span><span class="s1">&#39;userid&#39;</span><span class="p">);</span>
    <span class="k">delete</span> <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="main">
  <h2>
    <a href="#main" class="pilcrow">&#182;</a>
    main
  </h2>
</div>



<div class="pilwrap" id="the-main-user-view.">
  <h3>
    <a href="#the-main-user-view." class="pilcrow">&#182;</a>
    The main user view.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">main</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="tdr--added-cookie-support">
  <h3>
    <a href="#tdr--added-cookie-support" class="pilcrow">&#182;</a>
    TDR: added cookie support
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">userid</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">userid</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">flash</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="s1">&#39;Not logged in!&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/user/login&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span>   <span class="o">:</span> <span class="s1">&#39;User main&#39;</span><span class="p">,</span>
                         <span class="nx">message</span> <span class="o">:</span> <span class="s1">&#39;Login Successful&#39;</span><span class="p">,</span>
                         <span class="nx">users</span> <span class="o">:</span> <span class="nx">online</span><span class="p">,</span>
                         <span class="nx">username</span> <span class="o">:</span> <span class="nx">users</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                         <span class="nx">password</span> <span class="o">:</span> <span class="nx">users</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> 
                         <span class="nx">warble</span> <span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getWarbledb</span><span class="p">(),</span>
                         <span class="nx">follower</span> <span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getFollowerdb</span><span class="p">()</span>
                        <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="shows-the-other-users-online-at-a-point-in-time">
  <h2>
    <a href="#shows-the-other-users-online-at-a-point-in-time" class="pilcrow">&#182;</a>
    shows the other users online at a point in time
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">online</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;online&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;user Online&#39;</span><span class="p">,</span>
                         <span class="nx">users</span> <span class="o">:</span> <span class="nx">online</span> <span class="p">});</span>
<span class="p">};</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">warbles</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">warbles</span> <span class="o">=</span> <span class="nx">warbles</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;online&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;user Online&#39;</span><span class="p">,</span>
                         <span class="nx">users</span> <span class="o">:</span> <span class="nx">online</span> <span class="p">});</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="lets-users-discover-other-users-or-warbles">
  <h2>
    <a href="#lets-users-discover-other-users-or-warbles" class="pilcrow">&#182;</a>
    lets users discover other users or Warbles
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">discover</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;discover&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span>  <span class="o">:</span> <span class="s1">&#39;Discover&#39;</span><span class="p">,</span>
                            <span class="nx">users</span> <span class="o">:</span> <span class="nx">online</span><span class="p">,</span>
                            <span class="nx">allUsers</span> <span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getUserdb</span><span class="p">()});</span>
<span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="shows-warbles-at-a-user">
  <h2>
    <a href="#shows-warbles-at-a-user" class="pilcrow">&#182;</a>
    shows Warbles at a user
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">me</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">userid</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">userid</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">flash</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="s1">&#39;Not logged in!&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/user/login&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;me&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span>  <span class="o">:</span> <span class="s1">&#39;At Me&#39;</span><span class="p">,</span>
                    <span class="nx">username</span> <span class="o">:</span> <span class="nx">users</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                    <span class="nx">warble</span> <span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getWarbledb</span><span class="p">()</span>  <span class="p">});</span>
<span class="p">}</span>
<span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="renders-about-page">
  <h2>
    <a href="#renders-about-page" class="pilcrow">&#182;</a>
    renders about page
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">about</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;about&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span>  <span class="o">:</span> <span class="s1">&#39;About&#39;</span><span class="p">});</span>
<span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="allows-for-uploads">
  <h2>
    <a href="#allows-for-uploads" class="pilcrow">&#182;</a>
    allows for uploads
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">upload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;upload&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span>  <span class="o">:</span> <span class="s1">&#39;Upload&#39;</span><span class="p">});</span>
<span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="allows-for-users-and-warbles-to-be-displayed-on-profile-page">
  <h2>
    <a href="#allows-for-users-and-warbles-to-be-displayed-on-profile-page" class="pilcrow">&#182;</a>
    allows for users and warbles to be displayed on profile page
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">my_profile</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">userid</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">userid</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">flash</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="s1">&#39;Not logged in!&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/user/login&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span> <span class="p">(</span><span class="s1">&#39;my_profile&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;My Profile&#39;</span><span class="p">,</span>
                              <span class="nx">username</span> <span class="o">:</span> <span class="nx">users</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                              <span class="nx">warble</span> <span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getWarbledb</span><span class="p">(),</span>
                <span class="nx">follower</span> <span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getFollowerdb</span><span class="p">(),</span>
                <span class="nx">following</span> <span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getFollowingdb</span><span class="p">()</span>
                <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="gets-the-users-following-the-logged-in-warbler">
  <h2>
    <a href="#gets-the-users-following-the-logged-in-warbler" class="pilcrow">&#182;</a>
    gets the users following the logged in Warbler
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">followers</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">userid</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">userid</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">flash</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="s1">&#39;Not logged in!&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/user/login&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span> <span class="p">(</span><span class="s1">&#39;followers&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Followers&#39;</span><span class="p">,</span>
                              <span class="nx">username</span> <span class="o">:</span> <span class="nx">users</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                <span class="nx">follower</span> <span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getFollowerdb</span><span class="p">(),</span>
                <span class="nx">following</span> <span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getFollowingdb</span><span class="p">()</span>
              <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="gets-the-users-a-warbler-is-following">
  <h2>
    <a href="#gets-the-users-a-warbler-is-following" class="pilcrow">&#182;</a>
    gets the users a Warbler is following
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">following</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">userid</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">userid</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">flash</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="s1">&#39;Not logged in!&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/user/login&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="nx">online</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span> <span class="p">(</span><span class="s1">&#39;following&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Following&#39;</span><span class="p">,</span>
                              <span class="nx">username</span> <span class="o">:</span> <span class="nx">users</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                <span class="nx">following</span> <span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getFollowingdb</span><span class="p">(),</span>
                <span class="nx">follower</span> <span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getFollowerdb</span><span class="p">()</span>
              <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="creates-user-list">
  <h2>
    <a href="#creates-user-list" class="pilcrow">&#182;</a>
    creates user list
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">form</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  <span class="nx">genUserList</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">ul</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;form/&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span>
               <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;form - &#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span>
                 <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
                 <span class="nx">msg</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="nx">user</span><span class="o">:</span> <span class="nx">ul</span> <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="processes-form-get-requests-">
  <h3>
    <a href="#processes-form-get-requests-" class="pilcrow">&#182;</a>
    Processes form get requests:
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">process</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">id</span>   <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">auser</span> <span class="o">=</span> <span class="nx">userData</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">validateUser</span><span class="p">(</span><span class="nx">auser</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">user</span><span class="p">.</span><span class="nx">addUser</span><span class="p">(</span><span class="nx">auser</span><span class="p">);</span>
    <span class="nx">genUserList</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">ul</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;form/&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span>
                 <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;form - &#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span>
                   <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
                   <span class="nx">msg</span><span class="o">:</span> <span class="s1">&#39;Congrats! Your Account has been created!!&#39;</span><span class="p">,</span>
                   <span class="nx">user</span><span class="o">:</span> <span class="nx">ul</span> <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">smap</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;username&#39;</span><span class="o">:</span> <span class="s1">&#39;Username&#39;</span><span class="p">,</span>
      <span class="s1">&#39;password&#39;</span> <span class="o">:</span> <span class="s1">&#39;Password&#39;</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="s1">&#39;Missing information:&lt;br&gt;&#39;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">p</span> <span class="k">in</span> <span class="nx">smap</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span>
          <span class="nx">p</span> <span class="k">in</span> <span class="nx">smap</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">m</span> <span class="o">+=</span> <span class="nx">smap</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; is required! &lt;br/&gt;&#39;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">genUserList</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">ul</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;form/&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span>
                 <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;form - &#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span>
                   <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
                   <span class="nx">msg</span><span class="o">:</span> <span class="nx">m</span><span class="p">,</span>
                   <span class="nx">user</span><span class="o">:</span> <span class="nx">ul</span> <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="checks-for-user">
  <h2>
    <a href="#checks-for-user" class="pilcrow">&#182;</a>
    checks for user
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">userData</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">auser</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">===</span> <span class="s1">&#39;GET&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">auser</span> <span class="o">=</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40">&#182;</a>
</div>
<p>fname: req.query.fname,
lname: req.query.lname,
email: req.query.email,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">username</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
      <span class="nx">password</span> <span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span>
      <span class="nx">uid</span> <span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">uid</span><span class="p">,</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41">&#182;</a>
</div>
<p>sex  : req.query.sex,
month : req.query.month,
day : req.query.day,
year : req.query.year,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="err">##</span> <span class="nx">registers</span> <span class="nx">user</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">auser</span> <span class="o">=</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42">&#182;</a>
</div>
<p>fname: req.body.fname,
lname: req.body.lname,
email: req.body.email,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">username</span> <span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
      <span class="nx">password</span> <span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43">&#182;</a>
</div>
<p>sex  : req.body.sex,
month: req.body.month,
day  : req.body.day,
year : req.body.year,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="p">};</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="nx">auser</span><span class="p">;</span>
<span class="p">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="displays-user">
  <h3>
    <a href="#displays-user" class="pilcrow">&#182;</a>
    Displays user
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">genUserList</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
  <span class="nx">user</span><span class="p">.</span><span class="nx">getUserInfo</span><span class="p">([],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">list</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">u</span> <span class="o">=</span> <span class="s1">&#39;&lt;ul&gt;&#39;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">userInfo</span> <span class="o">=</span> <span class="nx">list</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="nx">u</span> <span class="o">+=</span> <span class="s1">&#39;&lt;li&gt;&#39;</span> <span class="o">+</span> <span class="nx">userInfo</span> <span class="o">+</span> <span class="s1">&#39;&lt;/li&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">u</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/ul&gt;&#39;</span><span class="p">;</span>
    <span class="nx">callback</span><span class="p">(</span><span class="nx">u</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
